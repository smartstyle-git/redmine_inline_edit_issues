<tr class="new-issue-row-data" data-index="0">
  <% @query_inline_columns.each_with_index do |column, index| %>
    <td class="<%= column.css_classes %>">
      <% case column.name %>
      <% when :tracker %>
        <% default_tracker = project.trackers.first %>
        <%= select_tag 'new_issues[0][tracker_id]', 
            options_for_select(project.trackers.collect { |t| [t.name, t.id] }, default_tracker&.id), 
            include_blank: true,
            class: 'new-issue-tracker' %>
      <% when :subject %>
        <%= text_field_tag 'new_issues[0][subject]', '', 
            placeholder: l(:field_subject),
            class: 'new-issue-subject',
            size: 20 %>
      <% when :status %>
        <% 
          # デフォルトトラッカーの利用可能なステータスを取得
          default_tracker = project.trackers.first
          initial_statuses = default_tracker && @tracker_statuses[default_tracker.id] ? @tracker_statuses[default_tracker.id] : []
          default_status_id = initial_statuses.first&.first if initial_statuses.any?
        %>
        <%= select_tag 'new_issues[0][status_id]', 
            options_for_select(initial_statuses.collect { |id, name| [name, id] }, default_status_id),
            class: 'new-issue-status',
            data: { tracker_statuses: @tracker_statuses.to_json } %>
      <% when :priority %>
        <%= select_tag 'new_issues[0][priority_id]', 
            options_for_select(IssuePriority.active.collect { |p| [p.name, p.id] }, 
                               IssuePriority.active.where(is_default: true).first&.id || IssuePriority.active.first&.id),
            class: 'new-issue-priority' %>
      <% when :assigned_to %>
        <%= select_tag 'new_issues[0][assigned_to_id]', 
            options_for_select(project.assignable_users.collect { |u| [u.name, u.id] }), 
            include_blank: true,
            class: 'new-issue-assigned-to' %>
      <% when :fixed_version %>
        <%= select_tag 'new_issues[0][fixed_version_id]', 
            options_for_select(project.shared_versions.collect { |v| [v.name, v.id] }), 
            include_blank: true,
            class: 'new-issue-version' %>
      <% when :start_date %>
        <%= date_field_tag 'new_issues[0][start_date]', '', 
            class: 'new-issue-start-date',
            size: 8 %>
      <% when :due_date %>
        <%= date_field_tag 'new_issues[0][due_date]', '', 
            class: 'new-issue-due-date',
            size: 8 %>
      <% when :description %>
        <%= text_area_tag 'new_issues[0][description]', '', 
            placeholder: l(:field_description),
            class: 'new-issue-description',
            rows: 2 %>
      <% when :category %>
        <%= select_tag 'new_issues[0][category_id]', 
            options_for_select(project.issue_categories.collect { |c| [c.name, c.id] }), 
            include_blank: true,
            class: 'new-issue-category' %>
      <% when :estimated_hours %>
        <%= text_field_tag 'new_issues[0][estimated_hours]', '', 
            size: 3,
            class: 'new-issue-estimated-hours' %>
      <% when :done_ratio %>
        <%= select_tag 'new_issues[0][done_ratio]', 
            options_for_select(((0..10).to_a.collect { |r| ["#{r * 10} %", r * 10] })),
            include_blank: true,
            class: 'new-issue-done-ratio' %>
      <% else %>
        <!-- 他の列は空白 -->
      <% end %>
      
      <% # 最後の列に削除ボタンを追加 %>
      <% if index == @query_inline_columns.size - 1 %>
        <button type="button" class="remove-new-issue" style="display:none; padding: 2px 8px; background: #d9534f; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 16px; font-weight: bold; margin-left: 5px;">-</button>
      <% end %>
    </td>
  <% end %>
</tr>
